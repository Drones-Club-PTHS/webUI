<!DOCTYPE html>
<html>

<head>
	<meta charset='utf-8'>
	<title>Drenes club - Tasks table</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel="stylesheet" href="table/table.css">
    <script>
        async function sendToGithub() {
			await window.studentsFile.commit(true);
			await window.tasksFile.commit(true);			
        }

		function rerender() {
			window.studentsTable.tableGenerator.generateTableContent();
			window.tasksTable.tableGenerator.generateTableContent();
		}

		function addNewTask() {
			let id = prompt("Task id:\n");
			let name = prompt("Task name:\n");
			if (id && name) {
				window.tasksFile.conent.push({"id": id, "name": name});
				rerender();
			}
		}
    </script>
	<style>
		.table {
			display: inline-block;
			margin: 1em;
		}
		.table td.current_student {
			color: red;
		}
		.table td.title {
			color: red;
		}
	</style>
</head>

<body>
	<button onclick="sendToGithub()" style="color: red;">Send to GitHub</button>
	<button onclick="rerender()">Rerender tables</button>
	<button onclick="addNewTask()">New Task</button>
	<br/>
	<table id="studentsTable" class="table"></table>
	<table id="tasksTable" class="table"></table>
	<script type="module">
		import { GitHubFile } from "./github/github_files.mjs";
		import { StudentsData } from "./parse_data/students_data.js";
		import { TableGenerator } from "./table/tableGenerator.mjs";
		import { studentsTableFunctions, tasksTableFunctions } from "./tasks_table.mjs";
		
		window.studentsTable = document.getElementById("studentsTable");
		window.tasksTable = document.getElementById("tasksTable");
		
		window.studentsFile = new GitHubFile("students.json");
		window.tasksFile = new GitHubFile("tasks.json");
		const fetchStudents = window.studentsFile.fetch().then(() => {
			window.students = new StudentsData(window.studentsFile);
		})
		const fetchTasks = window.tasksFile.fetch();

		window.data = {
			currentStudent: undefined,
			get tasks() { return window.tasksFile.content },
			get studentsData() { return window.students }
		}

		Promise.all([
			fetchStudents,
			fetchTasks
		]).then((results) => {
			window.studentsTable.tableGenerator = new TableGenerator(window.data, studentsTableFunctions, window.studentsTable);
			window.tasksTable.tableGenerator = new TableGenerator(window.data, tasksTableFunctions, window.tasksTable);
			window.studentsTable.tableGenerator.generateTableContent();
			window.tasksTable.tableGenerator.generateTableContent();
		});
	</script>
</body>

</html>
