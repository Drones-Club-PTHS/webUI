<!DOCTYPE html>
<html>

<head>
	<meta charset='utf-8'>
	<title>Drenes club - Visit table</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel="stylesheet" href="../0_table/table.css">
	<style>
		#sendGithubStatus {
			display: inline-block;
			width: 2em;
		}
	</style>
	<script>
		async function sendToGithub() {
			const status = document.getElementById("sendGithubStatus");
			status.innerHTML = "--";
			const res = await window.studentsFile.commit(true);
			if (res.commit) {
				status.innerHTML = "Ok";
			} else {
				console.error("Commit ERROR", res)
				status.innerHTML = ":(";
			}
		}

		function addNewLesson() {
			let date = prompt("Lesson full date\n(example, \"01.01.2001\")\n");
			if (date) {
				window.students.addNewLesson(date)
				window.visitTable.tableGenerator.generateTableContent();
			}
		}
		
		function addNewLessonToday() {
			const date = new Date();
			const dateString = date.toLocaleDateString('ru-RU', {
				year: "numeric",
				month: "2-digit",
				day: "2-digit"
			})
			window.students.addNewLesson(dateString)
			window.visitTable.tableGenerator.generateTableContent();
		}

		function addNewStudent() {
			let id = prompt("\"Фамилия Имя\"\n");
			if (id) {
				window.students.addStudent(id);
				window.visitTable.tableGenerator.generateTableContent();
			}
		}
	</script>
</head>

<body>
	<button onclick="sendToGithub()" style="color: red;">Send to GitHub</button>
	<div id="sendGithubStatus">--</div>
	<button onclick="window.visitTable.tableGenerator.generateTableContent();">Rerender table</button>
	<button onclick="addNewLesson()">New Lesson</button>
	<button onclick="addNewLessonToday()">New Lesson (today)</button>
	<button onclick="addNewStudent()">New Student</button>
	<table id="visitTable" class="table"></table>
	<script type="module">
		import { GitHubFile } from "../0_github/github_files.mjs";
		import { StudentsData } from "../0_parse_data/students_data.js";
		import { TableGenerator } from "../0_table/tableGenerator.mjs";
		import { functions } from "./visit_table.mjs";
		
		window.visitTable = document.getElementById("visitTable");
		window.studentsFile = new GitHubFile("students.json");
		window.students = new StudentsData(window.studentsFile);

		window.studentsFile.fetch()
			.then(() => {
				window.visitTable.tableGenerator = new TableGenerator(window.students, functions, document.getElementById("visitTable"));
				window.visitTable.tableGenerator.generateTableContent();
			});
	</script>
</body>

</html>
